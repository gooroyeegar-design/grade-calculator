<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="7VnCPN-c_Xel-VIxwV3LicJWGOkqx8UpFrS4zFBcDYI" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø°ÙƒÙŠØ© | Smart Grade Calc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root {
  --primary: #2563eb; --bg: #f8fafc; --card: #ffffff;
  --text-main: #0f172a; --text-muted: #64748b;
  --border: #e2e8f0; --success: #10b981; --accent: #8b5cf6;
  --error: #ef4444;
}
[data-theme="dark"] {
  --bg: #020617; --card: #1e293b; --text-main: #f8fafc;
  --text-muted: #94a3b8; --border: #334155; --primary: #3b82f6;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  background-color: var(--bg); color: var(--text-main);
  direction: rtl; margin: 0; padding: 15px;
  transition: background-color 0.3s ease;
}

.container { width: 100%; max-width: 480px; margin: 0 auto; padding-bottom: 50px; }

/* Top Navigation */
.top-nav { display: flex; justify-content: space-between; margin-bottom: 20px; }
.btn-ui { 
  background: var(--card); border: 1px solid var(--border); padding: 10px 16px; 
  border-radius: 14px; cursor: pointer; color: var(--text-main); font-size: 0.85rem;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
}

/* Goal Card */
.goal-card {
  background: linear-gradient(135deg, #6366f1, #a855f7);
  color: white; padding: 20px; border-radius: 24px;
  margin-bottom: 25px; box-shadow: 0 12px 20px -5px rgba(99, 102, 241, 0.4);
}
.goal-input-group { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
.goal-input-group input { 
  width: 80px; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3);
  color: white; text-align: center; font-weight: 800; padding: 8px; border-radius: 10px; font-size: 1.1rem;
}

/* Modules */
.module-card {
  background: var(--card); padding: 18px; margin-bottom: 15px;
  border-radius: 22px; border: 1px solid var(--border);
  box-shadow: 0 4px 6px rgba(0,0,0,0.02);
}
.card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.subject-name { font-weight: 700; font-size: 1rem; }
.badge { background: var(--bg); padding: 3px 10px; border-radius: 8px; font-size: 0.75rem; color: var(--primary); font-weight: 800; }

.input-row { display: flex; gap: 10px; }
.field { flex: 1; }
label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; }

input {
  width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid var(--border);
  background: var(--card); color: var(--text-main); font-size: 1rem; outline: none;
}
input:focus { border-color: var(--primary); }

/* Result Box */
#captureArea { padding: 10px; border-radius: 30px; }
.result-box {
  background: var(--primary); color: white; border-radius: 28px; padding: 30px;
  text-align: center; margin-top: 20px;
}
.avg-number { font-size: 4rem; font-weight: 900; margin: 5px 0; }

/* Analytics Chips */
.analytics { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
.chip { 
    display: flex; align-items: center; gap: 10px; padding: 12px; 
    border-radius: 15px; font-size: 0.85rem; font-weight: 600; 
}
.chip-best { background: rgba(16, 185, 129, 0.15); color: #d1fae5; border-right: 4px solid var(--success); }
.chip-worst { background: rgba(239, 68, 68, 0.15); color: #fee2e2; border-right: 4px solid var(--error); }

.action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
.btn-action {
    padding: 15px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem;
}
.btn-save { background: #0f172a; color: white; }
.btn-screenshot { background: var(--success); color: white; }

#toast {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: var(--error); color: white; padding: 10px 20px; border-radius: 50px;
  font-weight: bold; z-index: 9999; display: none;
}
</style>
</head>

<body>

<div id="toast">âš ï¸ Ø¹Ù„Ø§Ù…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>

<div class="container">
  <nav class="top-nav">
    <button class="btn-ui" onclick="toggleMode()">ğŸŒ“ Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
    <button class="btn-ui" onclick="clearAll()">ğŸ”„ ØªÙØ±ÙŠØº</button>
  </nav>

  <div class="goal-card">
    <div style="font-weight: 700;">ğŸ¯ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</div>
    <div class="goal-input-group">
      <input type="number" id="targetGoal" value="10.00" step="0.1" oninput="calculate()">
      <span style="font-size: 0.85rem; opacity: 0.9;">Ø­Ø¯Ø¯ Ù‡Ø¯ÙÙƒ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span>
    </div>
  </div>

  <div id="calculator-form">
    <div class="module-card">
      <div class="card-head"><span class="subject-name">Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
      <div class="input-row">
        <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m1c" placeholder="0.0"></div>
        <div class="field"><label>TD</label><input type="number" id="m1t" placeholder="0.0"></div>
      </div>
    </div>
    <div class="module-card">
        <div class="card-head"><span class="subject-name">Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø³ØªÙˆØ±ÙŠ</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
        <div class="input-row">
          <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m2c" placeholder="0.0"></div>
          <div class="field"><label>TD</label><input type="number" id="m2t" placeholder="0.0"></div>
        </div>
    </div>
    <div class="module-card">
        <div class="card-head"><span class="subject-name">ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 1</span></div>
        <div class="input-row">
          <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m3c" placeholder="0.0"></div>
          <div class="field"><label>TD</label><input type="number" id="m3t" placeholder="0.0"></div>
        </div>
    </div>
    <div class="module-card"><b>Ù…Ù†Ù‡Ø¬ÙŠØ©</b> <input type="number" id="m4" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ù…</b> <input type="number" id="m5" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</b> <input type="number" id="m6" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¯ÙˆÙ„ÙŠ</b> <input type="number" id="m7" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
  </div>

  <div id="captureArea" style="display:none;">
    <div class="result-box">
      <div id="statusLabel" style="font-weight: 800; opacity: 0.9;">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
      <div class="avg-number" id="avgOut">0.00</div>
      
      <div id="targetPrediction" style="font-size:0.85rem; background:rgba(0,0,0,0.1); padding:10px; border-radius:12px; margin-top:10px;"></div>

      <div class="analytics">
        <div id="bestModule" class="chip chip-best" style="display:none;"></div>
        <div id="worstModule" class="chip chip-worst" style="display:none;"></div>
      </div>
    </div>
  </div>

  <div class="action-buttons" id="actionBtns" style="display:none;">
    <button class="btn-action btn-save" onclick="downloadReport()">ğŸ“„ Ø­ÙØ¸ Ù†ØµÙŠ</button>
    <button class="btn-action btn-screenshot" onclick="takeScreenshot()">ğŸ“¸ ØµÙˆØ±Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</button>
  </div>
</div>

<script>
const inputs = document.querySelectorAll('input');
window.onload = () => {
    inputs.forEach(i => i.value = localStorage.getItem(i.id) || i.value);
    calculate();
};

inputs.forEach(input => {
    input.addEventListener('input', () => {
        if(parseFloat(input.value) > 20) { document.getElementById('toast').style.display='block'; return; }
        document.getElementById('toast').style.display='none';
        localStorage.setItem(input.id, input.value);
        calculate();
    });
});

function calculate() {
    const getV = (id) => {
        const v = document.getElementById(id).value;
        return v === "" ? null : parseFloat(v);
    };

    const modules = [
        { name: "Ù…Ø¯Ø®Ù„ Ù‚Ø§Ù†ÙˆÙ†", val: (getV('m1c')!==null && getV('m1t')!==null) ? (getV('m1c')*0.6 + getV('m1t')*0.4) : null, coef: 2 },
        { name: "Ø¯Ø³ØªÙˆØ±ÙŠ", val: (getV('m2c')!==null && getV('m2t')!==null) ? (getV('m2c')*0.6 + getV('m2t')*0.4) : null, coef: 2 },
        { name: "ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ", val: (getV('m3c')!==null && getV('m3t')!==null) ? (getV('m3c')*0.6 + getV('m3t')*0.4) : null, coef: 1 },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ©", val: getV('m4'), coef: 1 },
        { name: "ØªØ§Ø±ÙŠØ® Ù†Ø¸Ù…", val: getV('m5'), coef: 1 },
        { name: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", val: getV('m6'), coef: 1 },
        { name: "Ù…Ø¬ØªÙ…Ø¹ Ø¯ÙˆÙ„ÙŠ", val: getV('m7'), coef: 1 }
    ];

    let totalPoints = 0, filledCoefs = 0, missingCoefs = 0;
    let scores = [];

    modules.forEach(m => {
        if(m.val !== null) {
            totalPoints += (m.val * m.coef);
            filledCoefs += m.coef;
            scores.push(m);
        } else { missingCoefs += m.coef; }
    });

    if(filledCoefs === 0) {
        document.getElementById('captureArea').style.display = 'none';
        document.getElementById('actionBtns').style.display = 'none';
        return;
    }

    document.getElementById('captureArea').style.display = 'block';
    document.getElementById('actionBtns').style.display = 'grid';
    
    const finalAvg = (totalPoints / 9).toFixed(2);
    document.getElementById('avgOut').innerText = finalAvg;

    // Goal Logic
    const goal = parseFloat(document.getElementById('targetGoal').value) || 10;
    const predict = document.getElementById('targetPrediction');
    if(missingCoefs > 0) {
        const needed = ((goal * 9) - totalPoints) / missingCoefs;
        predict.innerHTML = needed > 20 ? "âš ï¸ Ø§Ù„Ù‡Ø¯Ù ÙŠØªØ·Ù„Ø¨ Ø¹Ù„Ø§Ù…Ø§Øª Ø®ÙŠØ§Ù„ÙŠØ©" : `Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù€ ${goal} ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø¯Ù„ <b>${needed.toFixed(2)}</b> ÙÙŠÙ…Ø§ ØªØ¨Ù‚Ù‰`;
    } else {
        predict.innerHTML = finalAvg >= goal ? "ğŸŠ ØªÙ… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù!" : "ğŸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ";
        if(finalAvg >= goal) confetti({ particleCount: 30, spread: 60 });
    }

    // Best/Worst Logic
    if(scores.length > 1) {
        const sorted = [...scores].sort((a,b) => b.val - a.val);
        document.getElementById('bestModule').style.display = 'flex';
        document.getElementById('bestModule').innerHTML = `ğŸŒŸ Ø§Ù„Ø£ÙØ¶Ù„: ${sorted[0].name} (${sorted[0].val.toFixed(2)})`;
        document.getElementById('worstModule').style.display = 'flex';
        document.getElementById('worstModule').innerHTML = `ğŸ“‰ Ø§Ù„Ø£Ø¶Ø¹Ù: ${sorted[sorted.length-1].name} (${sorted[sorted.length-1].val.toFixed(2)})`;
    }
}

function takeScreenshot() {
    const area = document.getElementById('captureArea');
    html2canvas(area, { backgroundColor: null, borderRadius: 30 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'MyGrades.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}

function downloadReport() {
    let txt = `Ù…Ø¹Ø¯Ù„ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ: ${document.getElementById('avgOut').innerText}\n`;
    txt += `${document.getElementById('bestModule').innerText}\n`;
    txt += `${document.getElementById('worstModule').innerText}`;
    const blob = new Blob([txt], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "grades.txt";
    link.click();
}

function toggleMode() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
}

function clearAll() { if(confirm('ØªÙØ±ÙŠØºØŸ')) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="7VnCPN-c_Xel-VIxwV3LicJWGOkqx8UpFrS4zFBcDYI" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø°ÙƒÙŠØ© | Smart Grade Calc</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root {
  --primary: #2563eb; --bg: #f8fafc; --card: #ffffff;
  --text-main: #0f172a; --text-muted: #64748b;
  --border: #e2e8f0; --success: #10b981; --accent: #8b5cf6;
  --error: #ef4444;
}
[data-theme="dark"] {
  --bg: #020617; --card: #1e293b; --text-main: #f8fafc;
  --text-muted: #94a3b8; --border: #334155; --primary: #3b82f6;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  background-color: var(--bg); color: var(--text-main);
  direction: rtl; margin: 0; padding: 15px;
  transition: background-color 0.3s ease;
}

.container { width: 100%; max-width: 480px; margin: 0 auto; padding-bottom: 50px; }

/* Top Navigation */
.top-nav { display: flex; justify-content: space-between; margin-bottom: 20px; }
.btn-ui { 
  background: var(--card); border: 1px solid var(--border); padding: 10px 16px; 
  border-radius: 14px; cursor: pointer; color: var(--text-main); font-size: 0.85rem;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
}

/* Goal Card */
.goal-card {
  background: linear-gradient(135deg, #6366f1, #a855f7);
  color: white; padding: 20px; border-radius: 24px;
  margin-bottom: 25px; box-shadow: 0 12px 20px -5px rgba(99, 102, 241, 0.4);
}
.goal-input-group { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
.goal-input-group input { 
  width: 80px; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3);
  color: white; text-align: center; font-weight: 800; padding: 8px; border-radius: 10px; font-size: 1.1rem;
}

/* Modules */
.module-card {
  background: var(--card); padding: 18px; margin-bottom: 15px;
  border-radius: 22px; border: 1px solid var(--border);
  box-shadow: 0 4px 6px rgba(0,0,0,0.02);
}
.card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.subject-name { font-weight: 700; font-size: 1rem; }
.badge { background: var(--bg); padding: 3px 10px; border-radius: 8px; font-size: 0.75rem; color: var(--primary); font-weight: 800; }

.input-row { display: flex; gap: 10px; }
.field { flex: 1; }
label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; }

input {
  width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid var(--border);
  background: var(--card); color: var(--text-main); font-size: 1rem; outline: none;
}
input:focus { border-color: var(--primary); }

/* Result Box */
#captureArea { padding: 10px; border-radius: 30px; }
.result-box {
  background: var(--primary); color: white; border-radius: 28px; padding: 30px;
  text-align: center; margin-top: 20px;
}
.avg-number { font-size: 4rem; font-weight: 900; margin: 5px 0; }

/* Analytics Chips */
.analytics { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
.chip { 
    display: flex; align-items: center; gap: 10px; padding: 12px; 
    border-radius: 15px; font-size: 0.85rem; font-weight: 600; 
}
.chip-best { background: rgba(16, 185, 129, 0.15); color: #d1fae5; border-right: 4px solid var(--success); }
.chip-worst { background: rgba(239, 68, 68, 0.15); color: #fee2e2; border-right: 4px solid var(--error); }

.action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
.btn-action {
    padding: 15px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem;
}
.btn-save { background: #0f172a; color: white; }
.btn-screenshot { background: var(--success); color: white; }

#toast {
  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
  background: var(--error); color: white; padding: 10px 20px; border-radius: 50px;
  font-weight: bold; z-index: 9999; display: none;
}
</style>
</head>

<body>

<div id="toast">âš ï¸ Ø¹Ù„Ø§Ù…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>

<div class="container">
  <nav class="top-nav">
    <button class="btn-ui" onclick="toggleMode()">ğŸŒ“ Ø§Ù„Ù…Ø¸Ù‡Ø±</button>
    <button class="btn-ui" onclick="clearAll()">ğŸ”„ ØªÙØ±ÙŠØº</button>
  </nav>

  <div class="goal-card">
    <div style="font-weight: 700;">ğŸ¯ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</div>
    <div class="goal-input-group">
      <input type="number" id="targetGoal" value="10.00" step="0.1" oninput="calculate()">
      <span style="font-size: 0.85rem; opacity: 0.9;">Ø­Ø¯Ø¯ Ù‡Ø¯ÙÙƒ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span>
    </div>
  </div>

  <div id="calculator-form">
    <div class="module-card">
      <div class="card-head"><span class="subject-name">Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
      <div class="input-row">
        <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m1c" placeholder="0.0"></div>
        <div class="field"><label>TD</label><input type="number" id="m1t" placeholder="0.0"></div>
      </div>
    </div>
    <div class="module-card">
        <div class="card-head"><span class="subject-name">Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø³ØªÙˆØ±ÙŠ</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
        <div class="input-row">
          <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m2c" placeholder="0.0"></div>
          <div class="field"><label>TD</label><input type="number" id="m2t" placeholder="0.0"></div>
        </div>
    </div>
    <div class="module-card">
        <div class="card-head"><span class="subject-name">ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ</span> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 1</span></div>
        <div class="input-row">
          <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m3c" placeholder="0.0"></div>
          <div class="field"><label>TD</label><input type="number" id="m3t" placeholder="0.0"></div>
        </div>
    </div>
    <div class="module-card"><b>Ù…Ù†Ù‡Ø¬ÙŠØ©</b> <input type="number" id="m4" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ù…</b> <input type="number" id="m5" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</b> <input type="number" id="m6" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¯ÙˆÙ„ÙŠ</b> <input type="number" id="m7" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
  </div>

  <div id="captureArea" style="display:none;">
    <div class="result-box">
      <div id="statusLabel" style="font-weight: 800; opacity: 0.9;">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
      <div class="avg-number" id="avgOut">0.00</div>
      
      <div id="targetPrediction" style="font-size:0.85rem; background:rgba(0,0,0,0.1); padding:10px; border-radius:12px; margin-top:10px;"></div>

      <div class="analytics">
        <div id="bestModule" class="chip chip-best" style="display:none;"></div>
        <div id="worstModule" class="chip chip-worst" style="display:none;"></div>
      </div>
    </div>
  </div>

  <div class="action-buttons" id="actionBtns" style="display:none;">
    <button class="btn-action btn-save" onclick="downloadReport()">ğŸ“„ Ø­ÙØ¸ Ù†ØµÙŠ</button>
    <button class="btn-action btn-screenshot" onclick="takeScreenshot()">ğŸ“¸ ØµÙˆØ±Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©</button>
  </div>
</div>

<script>
const inputs = document.querySelectorAll('input');
window.onload = () => {
    inputs.forEach(i => i.value = localStorage.getItem(i.id) || i.value);
    calculate();
};

inputs.forEach(input => {
    input.addEventListener('input', () => {
        if(parseFloat(input.value) > 20) { document.getElementById('toast').style.display='block'; return; }
        document.getElementById('toast').style.display='none';
        localStorage.setItem(input.id, input.value);
        calculate();
    });
});

function calculate() {
    const getV = (id) => {
        const v = document.getElementById(id).value;
        return v === "" ? null : parseFloat(v);
    };

    const modules = [
        { name: "Ù…Ø¯Ø®Ù„ Ù‚Ø§Ù†ÙˆÙ†", val: (getV('m1c')!==null && getV('m1t')!==null) ? (getV('m1c')*0.6 + getV('m1t')*0.4) : null, coef: 2 },
        { name: "Ø¯Ø³ØªÙˆØ±ÙŠ", val: (getV('m2c')!==null && getV('m2t')!==null) ? (getV('m2c')*0.6 + getV('m2t')*0.4) : null, coef: 2 },
        { name: "ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ", val: (getV('m3c')!==null && getV('m3t')!==null) ? (getV('m3c')*0.6 + getV('m3t')*0.4) : null, coef: 1 },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ©", val: getV('m4'), coef: 1 },
        { name: "ØªØ§Ø±ÙŠØ® Ù†Ø¸Ù…", val: getV('m5'), coef: 1 },
        { name: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", val: getV('m6'), coef: 1 },
        { name: "Ù…Ø¬ØªÙ…Ø¹ Ø¯ÙˆÙ„ÙŠ", val: getV('m7'), coef: 1 }
    ];

    let totalPoints = 0, filledCoefs = 0, missingCoefs = 0;
    let scores = [];

    modules.forEach(m => {
        if(m.val !== null) {
            totalPoints += (m.val * m.coef);
            filledCoefs += m.coef;
            scores.push(m);
        } else { missingCoefs += m.coef; }
    });

    if(filledCoefs === 0) {
        document.getElementById('captureArea').style.display = 'none';
        document.getElementById('actionBtns').style.display = 'none';
        return;
    }

    document.getElementById('captureArea').style.display = 'block';
    document.getElementById('actionBtns').style.display = 'grid';
    
    const finalAvg = (totalPoints / 9).toFixed(2);
    document.getElementById('avgOut').innerText = finalAvg;

    // Goal Logic
    const goal = parseFloat(document.getElementById('targetGoal').value) || 10;
    const predict = document.getElementById('targetPrediction');
    if(missingCoefs > 0) {
        const needed = ((goal * 9) - totalPoints) / missingCoefs;
        predict.innerHTML = needed > 20 ? "âš ï¸ Ø§Ù„Ù‡Ø¯Ù ÙŠØªØ·Ù„Ø¨ Ø¹Ù„Ø§Ù…Ø§Øª Ø®ÙŠØ§Ù„ÙŠØ©" : `Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù€ ${goal} ØªØ­ØªØ§Ø¬ Ù…Ø¹Ø¯Ù„ <b>${needed.toFixed(2)}</b> ÙÙŠÙ…Ø§ ØªØ¨Ù‚Ù‰`;
    } else {
        predict.innerHTML = finalAvg >= goal ? "ğŸŠ ØªÙ… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù!" : "ğŸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ";
        if(finalAvg >= goal) confetti({ particleCount: 30, spread: 60 });
    }

    // Best/Worst Logic
    if(scores.length > 1) {
        const sorted = [...scores].sort((a,b) => b.val - a.val);
        document.getElementById('bestModule').style.display = 'flex';
        document.getElementById('bestModule').innerHTML = `ğŸŒŸ Ø§Ù„Ø£ÙØ¶Ù„: ${sorted[0].name} (${sorted[0].val.toFixed(2)})`;
        document.getElementById('worstModule').style.display = 'flex';
        document.getElementById('worstModule').innerHTML = `ğŸ“‰ Ø§Ù„Ø£Ø¶Ø¹Ù: ${sorted[sorted.length-1].name} (${sorted[sorted.length-1].val.toFixed(2)})`;
    }
}

function takeScreenshot() {
    const area = document.getElementById('captureArea');
    html2canvas(area, { backgroundColor: null, borderRadius: 30 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'MyGrades.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}

function downloadReport() {
    let txt = `Ù…Ø¹Ø¯Ù„ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ: ${document.getElementById('avgOut').innerText}\n`;
    txt += `${document.getElementById('bestModule').innerText}\n`;
    txt += `${document.getElementById('worstModule').innerText}`;
    const blob = new Blob([txt], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "grades.txt";
    link.click();
}

function toggleMode() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
}

function clearAll() { if(confirm('ØªÙØ±ÙŠØºØŸ')) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
