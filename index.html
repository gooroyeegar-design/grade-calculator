<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="7VnCPN-c_Xel-VIxwV3LicJWGOkqx8UpFrS4zFBcDYI" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„: Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root {
  --primary: #2563eb; --bg: #f8fafc; --card: #ffffff;
  --text-main: #0f172a; --text-muted: #64748b;
  --border: #e2e8f0; --success: #10b981; --accent: #8b5cf6;
}
[data-theme="dark"] {
  --bg: #020617; --card: #1e293b; --text-main: #f8fafc;
  --text-muted: #94a3b8; --border: #334155;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  background-color: var(--bg); color: var(--text-main);
  direction: rtl; margin: 0; padding: 15px;
}
.container { width: 100%; max-width: 480px; margin: 0 auto; padding-bottom: 50px; }

/* Goal Setter Section */
.goal-card {
  background: linear-gradient(135deg, #6366f1, #a855f7);
  color: white; padding: 20px; border-radius: 20px;
  margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.3);
}
.goal-input-group { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
.goal-input-group input { 
  width: 80px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
  color: white; text-align: center; font-weight: bold; padding: 8px; border-radius: 8px;
}

.module-card {
  background: var(--card); padding: 18px; margin-bottom: 16px;
  border-radius: 20px; border: 1px solid var(--border);
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
}
.card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.badge { background: var(--bg); padding: 3px 10px; border-radius: 8px; font-size: 0.7rem; color: var(--primary); font-weight: bold; }

.input-row { display: flex; gap: 12px; }
.field { flex: 1; }
label { display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; }

input {
  width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid var(--border);
  background: var(--card); color: var(--text-main); font-size: 1rem; outline: none;
}
input:focus { border-color: var(--primary); }

.result-box {
  background: var(--primary); color: white; border-radius: 24px; padding: 30px;
  text-align: center; margin-top: 25px; display: none;
}
.avg-number { font-size: 4rem; font-weight: 900; margin: 5px 0; }
.target-msg { 
    background: rgba(0,0,0,0.1); padding: 10px; border-radius: 12px; 
    font-size: 0.85rem; margin-top: 15px; border-right: 4px solid white; text-align: right;
}

.btn-ui { background: var(--card); border: 1px solid var(--border); padding: 8px 14px; border-radius: 12px; cursor: pointer; color: var(--text-main); font-size: 0.8rem; }
.btn-download {
  width: 100%; background: #0f172a; color: white; border: none; padding: 15px;
  border-radius: 15px; font-weight: bold; margin-top: 15px; cursor: pointer; display: none;
}
[data-theme="dark"] .btn-download { background: #334155; }
</style>
</head>

<body>

<div class="container">
  <div style="display:flex; justify-content: space-between; margin-bottom: 15px;">
    <button class="btn-ui" onclick="toggleMode()">ğŸŒ“ ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
    <button class="btn-ui" onclick="clearAll()">ğŸ”„ ØªÙØ±ÙŠØº</button>
  </div>

  <div class="goal-card">
    <div style="font-weight: bold; font-size: 0.9rem;">ğŸ¯ Ø­Ø¯Ø¯ Ù‡Ø¯ÙÙƒ (Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø±ØºÙˆØ¨)</div>
    <div class="goal-input-group">
      <input type="number" id="targetGoal" value="10.00" step="0.1" oninput="calculate()">
      <span style="font-size: 0.8rem; opacity: 0.9;">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø°ÙŠ ØªØ·Ù…Ø­ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡</span>
    </div>
  </div>

  <div id="app">
    <div class="module-card">
      <div class="card-head"><b>Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</b> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
      <div class="input-row">
        <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m1c" placeholder="0.00"></div>
        <div class="field"><label>TD</label><input type="number" id="m1t" placeholder="0.00"></div>
      </div>
    </div>
    <div class="module-card">
      <div class="card-head"><b>Ù‚Ø§Ù†ÙˆÙ† Ø¯Ø³ØªÙˆØ±ÙŠ</b> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 2</span></div>
      <div class="input-row">
        <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m2c" placeholder="0.00"></div>
        <div class="field"><label>TD</label><input type="number" id="m2t" placeholder="0.00"></div>
      </div>
    </div>
    <div class="module-card">
        <div class="card-head"><b>ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ</b> <span class="badge">Ù…Ø¹Ø§Ù…Ù„ 1</span></div>
        <div class="input-row">
          <div class="field"><label>Ù…Ø­Ø§Ø¶Ø±Ø©</label><input type="number" id="m3c" placeholder="0.00"></div>
          <div class="field"><label>TD</label><input type="number" id="m3t" placeholder="0.00"></div>
        </div>
    </div>
    <div class="module-card"><b>Ù…Ù†Ù‡Ø¬ÙŠØ©</b> <input type="number" id="m4" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ù…</b> <input type="number" id="m5" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</b> <input type="number" id="m6" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
    <div class="module-card"><b>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¯ÙˆÙ„ÙŠ</b> <input type="number" id="m7" placeholder="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"></div>
  </div>

  <div class="result-box" id="resBox">
    <div id="statusTxt" style="font-weight:bold">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
    <div class="avg-number" id="avgOut">0.00</div>
    <div id="targetPrediction" class="target-msg" style="display:none;"></div>
  </div>

  <button class="btn-download" id="downloadBtn" onclick="downloadReport()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø© (TXT)</button>
</div>

<script>
const inputs = document.querySelectorAll('input');
let currentSummary = "";

window.onload = () => {
    inputs.forEach(i => i.value = localStorage.getItem(i.id) || i.value);
    calculate();
};

inputs.forEach(input => {
    input.addEventListener('input', () => {
        localStorage.setItem(input.id, input.value);
        calculate();
    });
});

function calculate() {
    const getV = (id) => {
        const val = document.getElementById(id).value;
        return val === "" ? null : parseFloat(val);
    };

    const modules = [
        { name: "Ù…Ø¯Ø®Ù„ Ù‚Ø§Ù†ÙˆÙ†", val: (getV('m1c') !== null && getV('m1t') !== null) ? (getV('m1c')*0.6 + getV('m1t')*0.4) : null, coef: 2 },
        { name: "Ø¯Ø³ØªÙˆØ±ÙŠ", val: (getV('m2c') !== null && getV('m2t') !== null) ? (getV('m2c')*0.6 + getV('m2t')*0.4) : null, coef: 2 },
        { name: "ØªÙ†Ø¸ÙŠÙ… Ù‚Ø¶Ø§Ø¦ÙŠ", val: (getV('m3c') !== null && getV('m3t') !== null) ? (getV('m3c')*0.6 + getV('m3t')*0.4) : null, coef: 1 },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ©", val: getV('m4'), coef: 1 },
        { name: "ØªØ§Ø±ÙŠØ® Ù†Ø¸Ù…", val: getV('m5'), coef: 1 },
        { name: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", val: getV('m6'), coef: 1 },
        { name: "Ù…Ø¬ØªÙ…Ø¹ Ø¯ÙˆÙ„ÙŠ", val: getV('m7'), coef: 1 }
    ];

    let totalPoints = 0, filledCoefs = 0, missingCoefs = 0;
    modules.forEach(m => {
        if(m.val !== null) { totalPoints += (m.val * m.coef); filledCoefs += m.coef; }
        else { missingCoefs += m.coef; }
    });

    const totalCoefficients = 9;
    const finalAvg = (totalPoints / totalCoefficients).toFixed(2);
    const resBox = document.getElementById('resBox');
    const dlBtn = document.getElementById('downloadBtn');
    
    if(filledCoefs === 0) { resBox.style.display = 'none'; dlBtn.style.display = 'none'; return; }
    
    resBox.style.display = 'block';
    dlBtn.style.display = 'block';
    document.getElementById('avgOut').innerText = finalAvg;

    const goal = parseFloat(document.getElementById('targetGoal').value) || 10;
    const predictDiv = document.getElementById('targetPrediction');
    let strategyTxt = "";

    if(missingCoefs > 0) {
        const needed = ((goal * totalCoefficients) - totalPoints) / missingCoefs;
        predictDiv.style.display = 'block';
        if(needed <= 0) strategyTxt = "Ù„Ù‚Ø¯ Ø­Ù‚Ù‚Øª Ù‡Ø¯ÙÙƒ Ø¨Ø§Ù„ÙØ¹Ù„! ÙˆØ§ØµÙ„ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ø¹Ø¯Ù„.";
        else if(needed > 20) strategyTxt = "Ø§Ù„Ù‡Ø¯Ù ØµØ¹Ø¨ØŒ ØªØ­ØªØ§Ø¬ Ù„Ø£ÙƒØ«Ø± Ù…Ù† 20 ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©.";
        else strategyTxt = `Ù„ØªØ­Ù‚ÙŠÙ‚ Ù‡Ø¯ÙÙƒ (${goal})ØŒ ØªØ­ØªØ§Ø¬ Ù„Ù…Ø¹Ø¯Ù„ ${needed.toFixed(2)} ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©.`;
    } else {
        predictDiv.style.display = 'none';
        if(finalAvg >= goal) confetti({ particleCount: 30, spread: 60 });
    }
    predictDiv.innerText = strategyTxt;

    // Prepare text for download
    currentSummary = `Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ\n`;
    currentSummary += `--------------------------\n`;
    currentSummary += `Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalAvg} / 20\n`;
    currentSummary += `Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø­Ø¯Ø¯: ${goal}\n`;
    if(strategyTxt) currentSummary += `Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„: ${strategyTxt}\n`;
    currentSummary += `--------------------------\n`;
    currentSummary += `ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙÙŠ: ${new Date().toLocaleString('ar-DZ')}`;
}

function downloadReport() {
    const blob = new Blob([currentSummary], { type: "text/plain;charset=utf-8" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "grade_report.txt";
    link.click();
}

function toggleMode() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
}

function clearAll() { if(confirm('ØªÙØ±ÙŠØºØŸ')) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
